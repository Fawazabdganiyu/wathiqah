# Project Rules & Context

## Project Structure
- **Monorepo**: Managed with Turbo Repo and PNPM.
- **apps/api**: NestJS application (Backend).
- **apps/web**: TanStack Start + React application (Frontend).
- **Database**: PostgreSQL with Prisma ORM (`apps/api/prisma`).

## Technology Stack
- **Backend**: NestJS, Prisma, PostgreSQL, Passport JWT, GraphQL (Schema first).
- **Frontend**: React, TanStack Start, TanStack Query, Tailwind CSS, Shadcn UI, Better Auth.
- **Language**: TypeScript (Strict mode).

## General Coding Rules
1.  **Configuration First**: Always check `.cursorrules` and project config files.
2.  **DRY**: Extract reusable logic.
3.  **Type Safety**: No `any`. Use strict typing. Zod for validation where applicable.
4.  **Naming**:
    -   Files: `kebab-case.ts`
    -   Classes: `PascalCase`
    -   Variables/Functions: `camelCase`
    -   Interfaces/Types: `PascalCase`
5.  **Comments**: Explain *why*, not *what*.

## Backend Rules (NestJS)
1.  **Architecture**: Follow standard NestJS module structure (Module, Controller/Resolver, Service).
2.  **Validation**: Use `class-validator` and `class-transformer` for DTOs.
3.  **Config**: NEVER hardcode secrets. Use `ConfigService` with `getOrThrow`.
4.  **Database**: Use Prisma for all DB interactions.
5.  **Security**:
    -   Enable CORS and Global Validation Pipes in `main.ts`.
    -   Use Environment Variables for all sensitive data (JWT secrets, DB URLs).
    -   Ensure consistent Authentication logic across the stack.

## Frontend Rules (React/TanStack)
1.  **Components**: Functional components with Hooks.
2.  **Styling**: Tailwind CSS.
3.  **State Management**: TanStack Query for server state. Local state for UI.
4.  **Routing**: TanStack Router (File-based routing).
5.  **UI Library**: Shadcn UI (install via `pnpm dlx shadcn@latest add <component>`).

## Critical Security & Integrity Rules
1.  **Secrets**: Never commit `.env` files. Check for hardcoded secrets before saving.
2.  **Auth**: Ensure JWT strategies use `ConfigService` and handle errors gracefully.
3.  **Validation**: All API inputs must be validated (DTOs).

## Workflow
-   **Package Manager**: `pnpm`.
-   **Commands**: Run commands from root unless specified. Use `turbo` for multi-app tasks.
